# Custom values for kube-prometheus-stack
# Optimized for Minikube / local development

# Prometheus configuration
prometheus:
  prometheusSpec:
    # Reduce resource usage for local dev
    resources:
      requests:
        memory: 400Mi
        cpu: 200m
      limits:
        memory: 800Mi
        cpu: 500m
    
    # Retain data for 7 days
    retention: 7d
    
    # Storage (optional, uses emptyDir by default)
    storageSpec: {}
    
    # Scrape config to discover our apps
    additionalScrapeConfigs:
      - job_name: 'demo-apps'
        kubernetes_sd_configs:
          - role: pod
            namespaces:
              names:
                - demo-apps
        relabel_configs:
          - source_labels: [__meta_kubernetes_pod_annotation_prometheus_io_scrape]
            action: keep
            regex: true
          - source_labels: [__meta_kubernetes_pod_annotation_prometheus_io_port]
            action: replace
            target_label: __address__
            regex: (.+)
            replacement: $1

# Grafana configuration
grafana:
  enabled: true
  adminPassword: infraguard123  # Change in production!
  
  # Default dashboards
  defaultDashboardsEnabled: true
  defaultDashboardsTimezone: browser
  
  resources:
    requests:
      memory: 128Mi
      cpu: 100m
    limits:
      memory: 256Mi
      cpu: 200m
  
  # Grafana.ini settings
  grafana.ini:
    server:
      root_url: "%(protocol)s://%(domain)s/"
    auth.anonymous:
      enabled: true
      org_role: Viewer

# AlertManager configuration
alertmanager:
  enabled: true
  alertmanagerSpec:
    resources:
      requests:
        memory: 64Mi
        cpu: 50m
      limits:
        memory: 128Mi
        cpu: 100m

# Disable components we don't need for demo
kubeStateMetrics:
  enabled: true

nodeExporter:
  enabled: true

# Reduce resource usage
prometheusOperator:
  resources:
    requests:
      memory: 100Mi
      cpu: 100m
    limits:
      memory: 200Mi
      cpu: 200m
